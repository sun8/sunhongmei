var MB=MB||{};+function(d){var c=window.MB=window.MB||{};var m={};Function.prototype.bind=Function.prototype.bind||function(r){return d.proxy(this,r)};var o=c.OpenLayer=function(t,r){var s=this.$el=d(t);this.$mask=d(".m-mask");this.optionsDefault={mask:true};this.options=d.extend({},this.optionsDefault,r);this._setPosition();d(document).on("click",".j-close",this._closeLayer.bind(this))};o.prototype._createMask=function(){if(this.$mask.length){this.$mask.height(document.body.scrollHeight).show()}else{var r=d('<div class="m-mask"></div>');r.height(document.body.scrollHeight);if(d(".g-wrap").length){r.insertAfter(".g-wrap")}this.$mask=d(".m-mask")}};o.prototype._setPosition=function(){this.$el.show(200);var x=this.$el.width(),w=this.$el.height(),s=window.innerWidth,r=window.innerHeight;var u=0,t=(r-w)/2+u,v=(s-x)/2;if(this.options.mask){this._createMask()}this.$el.css({top:t,left:v,"z-index":8999})};o.prototype._closeLayer=function(r){r.preventDefault();d(r.target).closest(".j-layer").hide();if(this.$mask.length){this.$mask.hide()}if(this.options.closeCallback){this.options.closeCallback()}};var l=c.Loading=function(s,r){this.$wrap=d(".g-wrap");this.$el=this.$wrap.find(".m-loading");this.text=s?s:"正在加载";this.custom=r?true:false;this.render()};l.prototype.render=function(){if(this.$el.length){this.$el.html("<b></b>"+this.text+"..");if(this.custom){this.$el.show()}else{new o(".m-loading",{mask:false})}}else{var r='<div class="m-loading" style="display:none;"><b></b>'+this.text+"..</div>";if(this.$wrap.length){this.$wrap.after(r)}this.$el=d(".m-loading");if(this.custom){this.$el.show()}else{new o(".m-loading",{mask:false})}}};l.prototype.hide=function(){this.$el.remove()};var f=c.GoTop=function(){this.$wrap=d(".g-wrap");this.el='<div id="J_GoTop" class="m-gotop" style="display:none;"></div>';this.$wrap.append(this.el);this.$el=d("#J_GoTop");this.$el.on("click",this.topAction.bind(this));d(window).on("scroll",this.showAction.bind(this))};f.prototype.showAction=function(){var t=document.body.scrollTop,s=window.innerHeight,r=t-s;(r>0)?this.$el.show():this.$el.hide()};f.prototype.topAction=function(){window.scrollTo(0,0)};var p=c.WaterfallList=function(s,r){this.options=d.extend({},r);this.$el=d(s);this._page=1;this.loading=new l("加载中");this.refresh()};p.prototype.refresh=function(){var r=this;d.ajax({type:"GET",url:this.options.url,data:{page:this._page},dataType:"json",beforeSend:function(){r.loading.render()},success:this._handleRequest.bind(this)})};p.prototype._handleNodata=function(){if(this.options.empty){this.options.empty()}else{}};p.prototype._handleRequest=function(s){this.loading.hide();var r=s.data[this.options.listKey];if(r.length==0){return this._handleNodata()}this._render(s.data)};p.prototype._render=function(u){var t=u.pageQuery;var r={};if(t&&!t.more){d("#J_AddMore").hide()}else{d("#J_AddMore").data("rendering",false);d("#J_AddMore").show()}r.list=u[this.options.listKey];var s=template.render(this.options.tpl,r);this.$el.append(s);this._page++};var n=c.PulldownRefresh=function(t,s){this.options=d.extend({},s);this.$el=d(t);this._page=1;this.nextPageLink="";this.loading=new l(this.options.loadingText?this.options.loadingText:"加载中");this.moreItem=d(this.options.moreSelector);this.more=true;this.winHeight=d(window).height();this.footEl=d(document.querySelector("footer"));this.footHeight=this.footEl.height();this.rendering=false;this.loading.render();this.footEl.hide();this.refresh(true);var r=this;d(window).on("scroll",r.pullUp.bind(this))};n.prototype.refresh=function(s){var r=this;if(this.rendering){return false}this.rendering=true;d.ajax({type:"GET",url:this.options.url,data:{page:this._page,nextPageLink:this.nextPageLink},dataType:"json",success:this._handleRequest.bind(this,s),error:function(){this.rendering=false}})};n.prototype.pullUp=function(){if(!this.more){return false}if(d(window).scrollTop()>d(this.options.docSelector).height()-this.winHeight-this.footHeight-50){this.moreItem.show();this.refresh()}};n.prototype._handleRequest=function(t,s){this.loading.hide();var r=s.data[this.options.listKey];if(r.length==0&&this._page==1){return this._handleNodata()}this._render(s.data,t)};n.prototype._handleNodata=function(){this.more=false;if(this.options.empty){this.options.empty()}else{}};n.prototype._render=function(u,w){var t=u.pageQuery;var v=u.nextPageLink;var r={};if(!!t){if(t.more){this._page=t.page+1}else{this.more=false;if(this.options.afterfinshed){this.options.afterfinshed()}}}else{this._page++;if(!!v){this.nextPageLink=v}else{this.more=false;if(this.options.afterfinshed){this.options.afterfinshed()}}}r=u;r.list=u[this.options.listKey];var s=template.render(this.options.tpl,r);this.$el.append(s);this.moreItem.hide();if(!this.more){this.footEl.show()}this.docHeight=d(this.options.docSelector).height();if(this.options.aftersuccess){this.options.aftersuccess(u)}this.rendering=false;if(w&&this.options.initExtraAction){this.options.initExtraAction(u)}if(!this.more){return}if(w&&this.docHeight<=this.winHeight){this.refresh()}};var j=c.Dropdown=function(){var r=this.el=".j-select";if(!r){return}d(r).on("click",this.showDrop.bind(this));d(document).on("click",this.hideDrop.bind(this))};j.prototype.showDrop=function(r){r.preventDefault();if(this.$crtOpen){this.$crtOpen.hide()}this.$crtOpen=d(r.currentTarget).next();this.$crtOpen.show(200)};j.prototype.hideDrop=function(r){if(d(r.target).hasClass("j-select")||d(r.target).parent().hasClass("j-select")){return}else{if(this.$crtOpen){this.$crtOpen.hide()}}};var e=c.PopTip=function(r){var s=d.type(r);this.$wrap=d(".g-wrap");if(s==="string"){this.content=r;this.type="blink"}else{if(s==="object"){this.optionsDefault={content:""};this.options=d.extend({},this.optionsDefault,r);this.content=this.options.content;this.type="toggle"}}this.render()};e.prototype.render=function(){if(this.type==="blink"){var r='<div class="m-tipbox" style="display:none">'+this.content+"</div>";this.$wrap.append(r);this.$el=d(".m-tipbox");new o(".m-tipbox",{mask:false});this.$el.css("top",2);this.delay();return}if(this.options.type==="toogle"){}};e.prototype.delay=function(){var r=this;var s=setTimeout(function(){r.destroy()},3000)};e.prototype.destroy=function(){this.$el.hide(200).remove()};var h=c.PopAlert=function(r){this.$wrap=d(".g-wrap");this.optionsDefault={type:"confirm",title:"",content:"",ok:"确定",cancel:"取消",callback:function(){return}};this.options=d.extend({},this.optionsDefault,r);this.render()};h.prototype.render=function(){var r=this;if(this.options.type==="confirm"){var s='<div id="j-confrim-box" class="m-alert j-layer" style="display:none;"><div class="info">';if(this.options.title.length){s+='<p class="para1">'+this.options.title+"</p>"}if(this.options.content.length){s+='<p class="para2">'+this.options.content+"</p>"}s+='</div><div class="button"><a class="confirm j-close ui-grey" href="javascript:;">'+this.options.cancel+'</a><a class="confirm ui-blue j-confirm" href="javascript:;">'+this.options.ok+"</a></div></div>";this.$wrap.append(s);d("#j-confrim-box .j-confirm").off("click").on("click",function(t){d(t.target).closest(".j-layer").hide();if(d(".m-mask").length){d(".m-mask").hide()}r.options.callback()});if(typeof(this.options.cancelCallback)==="function"){d("#j-confrim-box .j-close").on("click",function(t){r.options.cancelCallback()})}new o("#j-confrim-box")}if(this.options.type==="alert"){var s='<div id="j-alert-box" class="m-alert j-layer" style="display:none;"><div class="info">';if(this.options.title.length){s+='<p class="para1">'+this.options.title+"</p>"}if(this.options.content.length){s+='<p class="para2">'+this.options.content+"</p>"}s+='</div><div class="button"><a class="confirm confirm-1 ui-blue j-close" href="javascript:;">确 定</a></div></div>';this.$wrap.append(s);new o("#j-alert-box")}};var q=c.toast=function(u,w){var C;var t=w?w:1000;if(d(".m-toast").length){C=d(".m-toast");C.html(u);C.show()}else{C=d('<div class="m-toast">'+u+"</div>");C.appendTo("body")}C.css("opacity","1");var B=C.width(),v=C.height(),x=d(document).width(),y=d(window).height();var A=d(document.body).scrollTop(),z=(y-v)/2+A,r=(x-B)/2;C.css({top:z,left:r,"z-index":8999});if(s){clearTimeout(s)}var s=setTimeout(function(){C.css("opacity","0");setTimeout(function(){C.remove()},500)},t)};var a=c.Map=function(){this.elements=new Array();this.size=function(){return this.elements.length};this.isEmpty=function(){return(this.elements.length<1)};this.clear=function(){this.elements=new Array()};this.put=function(s,r){this.elements.push({key:s,value:r})};this.remove=function(r){var t=false;try{for(i=0;i<this.elements.length;i++){if(this.elements[i].key==r){this.elements.splice(i,1);return true}}}catch(s){t=false}return t};this.get=function(r){try{for(i=0;i<this.elements.length;i++){if(this.elements[i].key==r){return this.elements[i].value}}}catch(s){return null}};this.element=function(r){if(r<0||r>=this.elements.length){return null}return this.elements[r]};this.containsKey=function(r){var t=false;try{for(i=0;i<this.elements.length;i++){if(this.elements[i].key==r){t=true}}}catch(s){t=false}return t};this.containsValue=function(r){var t=false;try{for(i=0;i<this.elements.length;i++){if(this.elements[i].value==r){t=true}}}catch(s){t=false}return t};this.values=function(){var r=new Array();for(i=0;i<this.elements.length;i++){r.push(this.elements[i].value)}return r};this.keys=function(){var r=new Array();for(i=0;i<this.elements.length;i++){r.push(this.elements[i].key)}return r}};var b=c.Purl=function(r){this.query=r.indexOf("?")>=0?r.substr(r.indexOf("?")+1):"";this.path=r.indexOf("?")>=0?r.substr(0,r.indexOf("?")):r;this.m=new a();this.url="";this.split()};b.prototype.split=function(){if(this.query.length){var r=this.query.split("&");for(var s=0;s<r.length;s++){var t=r[s].split("=");this.m.put(decodeURIComponent(t[0]),decodeURIComponent(t[1]))}}else{return}};b.prototype.get=function(r){return this.m.get(r)};b.prototype.set=function(r,s){this.m.remove(r);this.m.put(r,s)};b.prototype.remove=function(r){this.m.remove(r)};b.prototype.build=function(){var r="";if(this.m.keys().length){for(k=0;k<this.m.keys().length;k++){if(k>0){r+="&"}r+=this.m.keys()[k]+"="+encodeURIComponent(this.m.values()[k])}}this.url+=this.path;if(r!=""){this.url+="?"+r}return this.url};var g=c.addGA=function(t,s,r){if(typeof _gaq!="undefined"&&_gaq.push){_gaq.push(["_trackEvent",t,s,r])}}}(Zepto||jQuery);