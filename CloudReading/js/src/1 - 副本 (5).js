(function(){var a=function(){var b=$("#search-input"),l,o,u,i,f,d,n=$("#J_SearchOps"),m=$("#J_SearchType");var q=$("#search-input"),g=$("#J_SearchOps"),k=$("#search-input-bottom"),e=$("#J_SearchOps_bottom");var s=[65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,48,49,50,51,52,53,54,55,56,57,96,97,98,99,100,101,102,103,104,105,8,186,187,188,189,190,191,32,108,13],h;var w=function(A,x){var z=A;if(z.length>x){var y=z.slice(0,x)+"..";$("#J_SearchOps li.parent em").text(y)}};var t=function(y){var x=y;if(x.attr("type")!="top"){if(x.css("display")=="none"){$("#foot-blank").css("display","none")}else{if(x.css("display")=="block"){$("#foot-blank").css("display","block")}}}};var j=function(A){var x=A,C="",z,y;if(x.code==0){z=0;var B=$("<div/>").text(z).html();if(!!x.data.hints){$.each(x.data.hints,function(F,D){var G=D.title;var H=D.id;var E=D.magGroup;if(E){C+='<li class="children"><a href="javascript:;" childLink='+D.childLink+">"+G+"</a></li>"}else{if(H!=null){C+='<li class="children"><a href="javascript:;" bookId='+H+">"+G+"</a></li>"}else{C+='<li class="children"><a href="javascript:;" >'+G+"</a></li>"}}})}else{C+='<li class="parent topli"><b class="book"></b><a href="#" type="4">搜"<em>'+B+'</em>"书籍</a></li>'}if(x.data.hints.length==0){n.css("display","none");t(n)}else{C+='<li class="children close"><a href="javascript:;" type="4">关闭</a></li>';n.empty().append(C).show();t(n)}o=-1;w(z,24);u=$("#J_SearchOps li");i=$("#J_SearchOps li").length;$("#J_SearchOps li a").click(function(F){if($(this).parent().hasClass("close")){$("#J_SearchOps").hide()}else{if($(this).attr("bookId")){var E=$(this).attr("bookId");location.href="/source/"+E}else{if($(this).attr("childLink")){var D=$(this).attr("childLink");location.href="/search/mag.do?nextPageLink="+encodeURIComponent(D)}else{if($(this).parent().hasClass("parent")){b.val(z)}else{b.val($(this).text())}$("#J_Form").submit();F.preventDefault()}}}});u=$("#J_SearchOps_bottom li");$("#J_SearchOps_bottom li a").click(function(F){if($(this).parent().hasClass("close")){$("#J_SearchOps_bottom").hide();t(n)}else{if($(this).attr("bookId")){var E=$(this).attr("bookId");location.href="/source/"+E}else{if($(this).attr("childLink")){var D=$(this).attr("childLink");location.href="/search/mag.do?nextPageLink="+encodeURIComponent(D)}else{if($(this).parent().hasClass("parent")){b.val(z)}else{b.val($(this).text())}$("#J_Form_bottom").submit();F.preventDefault()}}}})}};var p=function(x){if($.trim(x).length>0){$.ajax({type:"GET",url:"/search/hints.do",data:{key:x,count:5},dataType:"json",success:function(y){if(y){j(y)}else{YD.popTip("出错了，请稍候再试")}},error:function(){var y={resultCode:0,keyword:"",book:[{name:"鸡飞狗跳F班"},{name:"全部成为F"},{name:"超级卡片f"},{name:"银河1：UFO与水晶头骨"}]};j(y)}})}};b.keydown(function(z){var y=false;for(var x=0;x<s.length;x++){if(z.keyCode===s[x]){y=true;f=b.val();break}}if(y){if(l){clearTimeout(l)}}});var c=function(x){if(b.val().length>0){h=true;if(h){l=setTimeout(function(){var z=b.val();var y=$.trim(b.val());d=y;p(y)},200)}}else{if(b.val().length==0){n.hide();t(n)}}};var r=function(x){b=q;n=g;c(x)};var v=function(x){b=k;n=e;c(x)};if(b.get(0)){b.get(0).addEventListener("input",r,false)}if(k.get(0)){k.get(0).addEventListener("input",v,false)}};$().ready(function(){a()})})();